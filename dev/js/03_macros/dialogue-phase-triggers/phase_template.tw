/**
 * Conversation Setup Template
 * Use this file as a base for NPC-specific conversation option functions.
 * Each function controls which choices are available during a specific phase.
 * The actual response widgets live in a separate .tw file.
 */

/* Required: Use this function once to add all choices into #convoChoices */
setup.addChoices = function (list) {
  const $dialoguechoices = $("#convoChoices");
  $dialouugechoices.empty();

  list.forEach(([label, target]) => {
    if (State.variables.DEBUG) {
      console.log(`[DEBUG] Adding choice: "${label}" → ${target}`);
    }
    Wikifier.wikifyEval(`<<dialoguechoice \"${label}\" \"${target}\">>`);
  });
};

/* Optional: Short helper to conditionally add choices */
setup.if = (condition, list) => condition ? list : [];


/**
 * PHASE 0: Initial Meeting
 * Usually first time the player speaks with this character.
 */
setup.NPC_Conversation_Options_Phase0 = function () {
  setup.addChoices([
    ["Greet them politely.", "NPC_Greet", 0],
    ["Who are you?", "NPC_AskIdentity", 0],
    ["Leave.", "GENERIC", 0]
  ]);
};


/**
 * PHASE 1: Unlocked after building some rapport.
 * Could happen after a minigame, trust increase, or story event.
 */
setup.NPC_Conversation_Options_Phase1 = function () {
  setup.addChoices([
    ["Ask about the Black Cowls.", "NPC_AskBlackCowls", 0],
    ...setup.if(State.variables.seenBlackCowlIntro, [
      ["Why are they dangerous?", "NPC_WhyBad", 0],
      ["Do we know how to stop them?", "NPC_HowToStop", 0]
    ]),
    ["Let’s talk about something else.", "GENERIC" 1]
  ]);
};


/**
 * PHASE 2: Could be post-event, or relationship milestone
 */
setup.NPC_Conversation_Options_Phase2 = function () {
  setup.addChoices([
    ["You seem different tonight.", "NPC_DifferentTonight", 0],
    ["Open up about yourself.", "NPC_PlayerShares", 0],
    ["Let’s go somewhere private.", "NPC_NSFWTier1", 1]
  ]);
};


/**
 * GENERIC: Fallback default dialogue if no phase is explicitly called.
 */
setup.NPC_Conversation_Options_Generic = function () {
  setup.addChoices([
    ["How’s the night going?", "NPC_GenericSmallTalk", 0],
    ["Goodbye for now.", "ReturnToParlor", 0]
  ]);
};


/**
 * CUSTOM BRANCH: Optional tree that is unlocked based on story/flags
 * Can be called from another widget to show a mini-topic hub
 */
setup.NPC_AskBlackCowls_SubTree = function () {
  setup.addChoices([
    ["Why are they bad?", "NPC_WhyBad", 0],
    ["Where do they come from?", "NPC_Origin", 0],
    ["Do we know how to stop them?", "NPC_HowToStop", 0],
    ["Nevermind.", "NPC_ReturnToMain", 1]
  ]);
};
